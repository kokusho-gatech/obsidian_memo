# UsersController

> 本来のクラス名は UsersController です

---

## アクション一覧と詳細

### `index` (出典: app/controllers/users_controller.rb:8)

* **機能概要:**
  ユーザー一覧の検索・表示。
* **処理フロー:**
    1. User.searchで検索（:9）
    2. 権限種別一覧を取得（:10）
* **返すもの:**
    - 一覧画面のHTML

---

### `show` (出典: app/controllers/users_controller.rb:13)

* **機能概要:**
  ユーザー詳細の表示。
* **処理フロー:**
    1. ユーザー取得（:14）
    2. Google認証URL取得（:15）
* **返すもの:**
    - 詳細画面のHTML

---

### `new` (出典: app/controllers/users_controller.rb:18)

* **機能概要:**
  新規ユーザー作成画面の表示（管理者のみ）。
* **処理フロー:**
    1. 権限チェック（:19）
    2. 新規インスタンス作成・補助変数セット（:21-22, private:109-113）
* **返すもの:**
    - 新規作成画面のHTMLまたはリダイレクト

---

### `edit` (出典: app/controllers/users_controller.rb:25)

* **機能概要:**
  ユーザー編集画面の表示（管理者のみ）。
* **処理フロー:**
    1. 権限チェック（:26）
    2. ユーザー取得・補助変数セット（:28-29, private:109-113）
* **返すもの:**
    - 編集画面のHTMLまたはリダイレクト

---

### `create` (出典: app/controllers/users_controller.rb:32)

* **機能概要:**
  新規ユーザーの作成（管理者のみ）。
* **処理フロー:**
    1. 権限チェック（:33）
    2. 新規インスタンス作成（:35）
    3. 保存処理（:37-43）
    4. 成功時は一覧へリダイレクト、失敗時はエラー表示
* **返すもの:**
    - リダイレクトまたはエラー表示

---

### `update` (出典: app/controllers/users_controller.rb:46)

* **機能概要:**
  ユーザー情報の更新（管理者のみ）。
* **処理フロー:**
    1. 権限チェック（:47）
    2. ユーザー取得（:49）
    3. 更新処理（:51-57）
    4. 成功時は一覧へリダイレクト、失敗時はエラー表示
* **返すもの:**
    - リダイレクトまたはエラー表示

---

### `login` (出典: app/controllers/users_controller.rb:60)

* **機能概要:**
  ログイン処理。
* **処理フロー:**
    1. ログイン済みならユーザー詳細へリダイレクト、未ログインならGoogle認証へ（:61-65）
* **返すもの:**
    - リダイレクト

---

### `authorize_gmail` (出典: app/controllers/users_controller.rb:67)

* **機能概要:**
  Gmail認証処理。
* **処理フロー:**
    1. 認証コードがあればGoogleApi::Gmailで認証（:68-70）
    2. 成功/失敗時はユーザー詳細へリダイレクト（:71-74）
* **返すもの:**
    - リダイレクト

---

### `clear_gmail_authorization` (出典: app/controllers/users_controller.rb:76)

* **機能概要:**
  Gmail認証情報の削除。
* **処理フロー:**
    1. ユーザー取得（:77）
    2. 認証済みなら削除（:79-81）
    3. 削除後または未認証時は詳細へリダイレクト（:82-84）
* **返すもの:**
    - リダイレクト

---

## 関連リンク
- [[User]]
- [[認証・権限]]
- [[Google連携]] 